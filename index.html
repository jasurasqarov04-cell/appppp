if (isToday) {
                    score = calculateScore();
                } else if (historyIndex >= 0 && data.history[historyIndex]) {
                    score = data.history[historyIndex].score;
                }

                const height = Math.max(4, (score / 100) * 120);
                const isGood = score >= 70;

                html += `
                    <div class="chart-bar-wrapper">
                        <div class="chart-value">${score}</div>
                        <div class="chart-bar ${isGood ? 'good' : 'bad'}" style="height: ${height}px;">
                            <div class="chart-bar-fill" style="height: 100%;"></div>
                        </div>
                        <div class="chart-label">${isToday ? '–°–µ–≥' : days[dayIndex]}</div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // Insights
        function updateInsights() {
            const score = calculateScore();
            const completedTasks = data.today.tasks.filter(t => t.completed).length;
            const totalTasks = data.today.tasks.length;

            let insight = '';

            if (score >= 90) {
                insight = 'üåü –û—Ç–ª–∏—á–Ω—ã–π –¥–µ–Ω—å! –í—ã –Ω–∞ –ø–∏–∫–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã. –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å!';
            } else if (score >= 70) {
                insight = 'üëç –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –ù–µ–º–Ω–æ–≥–æ —É—Å–∏–ª–∏–π ‚Äî –∏ –±—É–¥–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ.';
            } else if (score >= 50) {
                insight = 'üí™ –°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å –µ—â—ë –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞—á.';
            } else {
                insight = 'üöÄ –ù–∞—á–Ω–∏—Ç–µ —Å –º–∞–ª–æ–≥–æ ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–¥–Ω—É –≤–∞–∂–Ω—É—é –∑–∞–¥–∞—á—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!';
            }

            if (data.today.water.value < 1) {
                insight += ' –ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤—ã–ø–∏—Ç—å –≤–æ–¥—ã!';
            }

            if (totalTasks > 0 && completedTasks === 0) {
                insight = '‚ö°Ô∏è –£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏. –í—ã–±–µ—Ä–∏—Ç–µ —Å–∞–º—É—é –ø—Ä–æ—Å—Ç—É—é –∏ —Å–¥–µ–ª–∞–π—Ç–µ –µ—ë!';
            }

            document.getElementById('insightText').textContent = insight;
        }

        function checkStreak() {
            // Streak logic handled in checkNewDay
        }

        // Event Listeners
        document.getElementById('quickTaskInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addQuickTask();
        });

        document.getElementById('taskTitle').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addTask();
        });

        // Close modal on outside click
        document.getElementById('taskModal').addEventListener('click', (e) => {
            if (e.target.id === 'taskModal') closeModal();
        });

        // Auto-save every 30 seconds
        setInterval(saveData, 30000);
    </script>
</body>
</html>
